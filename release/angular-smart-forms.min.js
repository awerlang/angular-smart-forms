// https://github.com/awerlang/angular-smart-forms
!function(){"use strict";function isItMobile(){return"ontouchstart"in document.documentElement&&window.innerWidth<768}function findNextTabStop(el,parent){var universe=(parent||document).querySelectorAll("input, button, select, textarea, a[href]"),list=Array.prototype.filter.call(universe,function(item){return item.tabIndex>="0"}),index=list.indexOf(el);return list[index+1]||list[0]}function tabToNext(currentElement,parent){var nextElement=findNextTabStop(currentElement);nextElement&&nextElement.focus()}function smartForm(){return{restrict:"A",link:function(scope,element,attrs){function tabOnMaxLength(event){var maxLength=event.target.maxLength;maxLength&&event.target.value.length===maxLength&&tabToNext(event.target,element[0])}function tabOnEnter(event){if(13===event.which){var el=event.target;switch(el.tagName){case"INPUT":if("submit"===el.type||"button"===el.type)return;case"SELECT":tabToNext(event.target,element[0]),event.preventDefault()}}}element.on("input",tabOnMaxLength),element.on("keydown",tabOnEnter)}}}function autoFocus(){return isItMobile()?{}:{restrict:"A",link:function(scope,element){function setFocus(selector){var firstElement=element[0].querySelector(selector);firstElement&&firstElement.focus()}function setFocusOnPartialLoaded(){setFocus(["input:not([disabled])","select:not([disabled])","fieldset:not([disabled]) input:not([disabled])","fieldset:not([disabled]) select:not([disabled])"].join(","))}function setFocusOnFormSubmit(){setFocus(".ng-invalid")}scope.$on("$viewContentLoaded",setFocusOnPartialLoaded),scope.$on("$includeContentLoaded",setFocusOnPartialLoaded),element.on("submit",setFocusOnFormSubmit)}}}function isoDate(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl.$parsers.push(function(value){return console.debug("parse",typeof value,value),value&&value.toISOString().substring(0,10)+"T00:00:00.000Z"}),ngModelCtrl.$formatters.push(function(value){if(console.debug("format",typeof value,value),"string"==typeof value){var regex=/(\d{4})-(\d{2})-(\d{2})T?.*/,dateParts=regex.exec(value);if(dateParts)return new Date(parseInt(dateParts[1],10),parseInt(dateParts[2],10)-1,parseInt(dateParts[3],10))}return value})}}}angular.module("wt.smart",[]).directive("wtAutoFocus",[autoFocus]).directive("wtSmartForm",[smartForm]).directive("wtIsoDate",[isoDate])}();